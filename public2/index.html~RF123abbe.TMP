<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Army React</title>
  <script src="node_modules/react/dist/JSXTransformer.js"></script>
  <script src="node_modules/react/dist/react.js"></script>
  <script src="node_modules/jquery/dist/jquery.js"></script>

</head>
<body>
  
  <script type="text/jsx">
    var army;
    var message;
    var rendered = false;

    $(document).ready(function () {

      function getArmy () {

        $.get('army').success(function (data) {
          
          console.log(data);
          army = data;

          if (!rendered) {
            renderArmy(army)            
          };

        });

      };

      function renderArmy (army) {

        rendered = true;

        React.render(
          <Corp corp={army.corps[0]} />,
          document.body
        );
      
      };  

      var Corp = React.createClass({
        render: function() {
          return (
            <div>
              <UnitName commander={this.props.corp.commander} />
              <UnitCommander commander={this.props.corp.commander} />
            </div>
          );
        }
      });

      var UnitName = React.createClass({
        render: function() {
          return (
            <p>{this.props.name}</p>
          );
        }
      });

      var UnitCommander = React.createClass({
        render: function() {
          return (
            <p>{this.props.commander.rank} {this.props.commander.firstName} {this.props.commander.lastName}</p>
          );
        }
      });     

      setInterval(function(){
        getArmy();        
      }, 2000);

    });
  </script>

</body>
</html>